"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[860],{4479:(v,h,i)=>{i.r(h),i.d(h,{default:()=>y});var a=i(9417),u=i(7651),m=i(5490),t=i(4328),c=i(5974),e=i(4438),d=i(177),p=i(8064),f=i(1165);function _(g,C){1&g&&(e.j41(0,"div",16),e.EFF(1," Please provide title "),e.k0s())}function E(g,C){1&g&&(e.j41(0,"div",16),e.EFF(1," Please pick an Employee "),e.k0s())}let y=(()=>{class g{constructor(n,o,r,l){this.location=n,this.fb=o,this.userService=r,this.router=l,this.employees=[],this.files=[],this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search..."},this.Editor=t.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[t.uwK,t.C1k,t.Z4w,t.ayq,t.f4q,t.L$Z,t.tqO,t.yN4,t.J20,t.GkN,t.z2z,t.Y0,t.DZT,t.txU,t._V3,t.qIF,t.bsd,t.FUH,t.BRX,t.uXn,t.N_E,t.B8B,t.Syw,t.fzL,t.mYY,t.XIK,t.e1U],height:"400px"},this.InsertChangeLog=this.fb.group({changeOrder:["",a.k0.required],title:["",a.k0.required],comment:["",a.k0.required],jpayrollEmployee:["",a.k0.required],userId:["",a.k0.required],files:[null]})}ngOnInit(){this.fetchEmployees();const n=this.location.getState();console.log(n),this.changetype=n.changetype,n&&n.changeOrder&&n.companyname&&(this.changeorder=n.changeOrder,this.companyname=n.companyname),n&&n.changeOrder&&(this.changeOrder1=n.changeOrder,this.InsertChangeLog.patchValue({changeOrder:this.changeOrder1}))}onFileChange(n){const o=n.target.files;if(this.files=[],o.length>0){const r=o[0];let l=r.name.replace(/\s+/g,"_");const s=new File([r],l,{type:r.type});this.files=[s]}}onEmployeeChange(n){n?this.InsertChangeLog.patchValue({jpayrollEmployee:n.value,userId:n.value.value}):console.error("No employee selected!")}onEditorReady(n){console.log("Editor is ready:",n)}fetchEmployees(){this.userService.getEmployees().subscribe(n=>{this.employees=n.map(o=>({value:o.UserId,label:o.Name}))},n=>{console.error("Error fetching employees",n)})}onSubmit(){if(this.InsertChangeLog.valid){const n=new FormData;n.append("file",this.files[0]),this.userService.uploadFile(n).subscribe(o=>{const r={changeOrder:this.InsertChangeLog.get("changeOrder")?.value,title:this.InsertChangeLog.get("title")?.value,comment:this.InsertChangeLog.get("comment")?.value,userId:this.InsertChangeLog.get("userId")?.value,filePath:o.filePath};this.userService.insertChangeLog(r).subscribe(l=>{alert("Form Has been submitted");const s=this.InsertChangeLog.get("changeOrder")?.value;this.InsertChangeLog.reset({changeOrder:s}),document.getElementById("files").value="",this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname,changetype:this.changetype}})},l=>{console.error("Error:",l)})},o=>{console.error("Error:",o)})}else this.InsertChangeLog.markAllAsTouched()}static{this.\u0275fac=function(o){return new(o||g)(e.rXU(d.aZ),e.rXU(a.ok),e.rXU(p.D),e.rXU(f.Ix))}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["app-insert-change-log"]],standalone:!0,features:[e.aNF],decls:28,vars:9,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder",1,"form-control",3,"readonly"],["for","title",1,"form-label"],["id","title","formControlName","title",1,"form-control"],["class","text-danger small",4,"ngIf"],["for","comment",1,"form-label"],["formControlName","comment",3,"editor","config"],["for","jpayrollEmployee",1,"form-label"],["formControlName","jpayrollEmployee",3,"change","options","config","multiple"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],["type","submit",1,"btn","btn-primary","w-100"],[1,"text-danger","small"]],template:function(o,r){if(1&o&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2,"Change Log Form"),e.k0s(),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return r.onSubmit()}),e.j41(4,"div",3)(5,"label",4),e.EFF(6,"Change Order"),e.k0s(),e.nrm(7,"input",5),e.k0s(),e.j41(8,"div",3)(9,"label",6),e.EFF(10,"Title"),e.k0s(),e.nrm(11,"input",7),e.DNE(12,_,2,0,"div",8),e.k0s(),e.j41(13,"div",3)(14,"label",9),e.EFF(15,"Comment"),e.k0s(),e.nrm(16,"ckeditor",10),e.k0s(),e.j41(17,"div",3)(18,"label",11),e.EFF(19,"JPayroll Employee"),e.k0s(),e.j41(20,"ngx-select-dropdown",12),e.bIt("change",function(s){return r.onEmployeeChange(s)}),e.k0s(),e.DNE(21,E,2,0,"div",8),e.k0s(),e.j41(22,"div",3)(23,"label",13),e.EFF(24,"Upload Files"),e.k0s(),e.j41(25,"input",14),e.bIt("change",function(s){return r.onFileChange(s)}),e.k0s()(),e.j41(26,"button",15),e.EFF(27,"Submit"),e.k0s()()()),2&o){let l,s;e.R7$(3),e.Y8G("formGroup",r.InsertChangeLog),e.R7$(4),e.Y8G("readonly",!0),e.R7$(5),e.Y8G("ngIf",(null==(l=r.InsertChangeLog.get("title"))?null:l.invalid)&&(null==(l=r.InsertChangeLog.get("title"))?null:l.touched)),e.R7$(4),e.Y8G("editor",r.Editor)("config",r.config),e.R7$(4),e.Y8G("options",r.employees)("config",r.selectEmployeeConfig)("multiple",!1),e.R7$(),e.Y8G("ngIf",(null==(s=r.InsertChangeLog.get("jpayrollEmployee"))?null:s.invalid)&&(null==(s=r.InsertChangeLog.get("jpayrollEmployee"))?null:s.touched))}},dependencies:[u.G,d.bT,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,m.w8,m.hW,c.ae,c.W5],styles:[".ck-editor__editable{min-height:150px}\n"],encapsulation:2})}}return g})()}}]);