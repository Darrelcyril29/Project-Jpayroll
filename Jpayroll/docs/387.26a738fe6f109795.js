"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[387],{8387:(M,F,a)=>{a.r(F),a.d(F,{default:()=>A});var E=a(7651),b=a(5490),i=a(4328),k=a(5974),e=a(4438),R=a(1165),d=a(9417),D=a(8064),O=a(467),j=a(2887),N=a(2578),T=a(7482);let I=(()=>{class n{constructor(){}generateExcel(r){var o=this;return(0,O.A)(function*(){const l=new j.Workbook,t=l.addWorksheet("Sheet 1");t.columns=[{key:"A",width:2},{key:"B",width:20},{key:"C",width:20},{key:"D",width:10},{key:"E",width:20},{key:"F",width:25}];try{const g=yield(yield fetch("../../../assets/images/JpayrollLogo.png")).arrayBuffer(),v=l.addImage({buffer:g,extension:"png"});t.addImage(v,{tl:{col:1,row:0},ext:{width:150,height:40}})}catch(c){console.error("Error loading image:",c)}t.mergeCells("B1:D2"),t.mergeCells("E1:F1"),t.getCell("E1").value="Change Order",t.getCell("E1").font={bold:!0,size:14},t.getCell("E1").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("E2:F2"),t.getCell("E2").value=r.changeOrder,t.getCell("E2").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("B3:F3"),t.getCell("B3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B3").value="Project Information",t.getCell("B3").alignment={horizontal:"center"},t.getCell("B3").font={bold:!0,color:{argb:"FFFFFFFF"}},t.getCell("B4").value="Customer Name",t.getCell("C4").value=r.clientName||"",t.mergeCells("C4:D4"),t.getCell("B5").value="Customer Address",t.getCell("C5").value=r.customerAddress||"",t.mergeCells("C5:F5"),t.getCell("E4").value="Ref No",t.getCell("E4").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("F4:F4"),t.getCell("F4").value=r.refNo||"",t.mergeCells("B7:F7"),t.getCell("B7").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B7").value="Change Order Information",t.getCell("B7").alignment={horizontal:"center"},t.getCell("B7").font={bold:!0,color:{argb:"FFFFFFFF"}},t.getCell("B8").value="Change Type",t.getCell("B9").value="Change Details",t.getCell("B10").value="Priority",t.getCell("B11").value="Mandays",t.getCell("B12").value="Delivery Date",t.getCell("B13").value="Comments",t.getCell("C8").value=r.changeType,t.getCell("C9").value={richText:o.parseRichText(r.changeDetails)};const s=o.parseRichText(r.changeDetails),C=s.map(c=>c.text).join("").split("\n").length,u=s.reduce((c,g)=>c+g.text.length,0)/40,f=Math.ceil(C+u);t.getRow(9).height=Math.max(20,15*f),t.getCell("C9").alignment={wrapText:!0},r.priority=(r.priority=1)?"High":(r.priority=2)?"Medium":"Low",t.getCell("C10").value=r.priority||"",t.getCell("C11").value=r.mandays||"",t.getCell("C12").value=r.deliveryDate||"",t.getCell("C13").value={richText:o.parseRichText(r.comment)};const p=o.parseRichText(r.comment),P=p.map(c=>c.text).join("").split("\n").length,Y=p.reduce((c,g)=>c+g.text.length,0)/40,X=Math.ceil(P+Y);t.getRow(13).height=Math.max(20,15*X),t.getCell("C13").alignment={wrapText:!0},t.mergeCells("C8:F8"),t.mergeCells("C9:F9"),t.mergeCells("C10:F10"),t.mergeCells("C11:F11"),t.mergeCells("C12:F12"),t.mergeCells("C13:F13"),t.mergeCells("B15:F15"),t.getCell("B15").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B15").value="Sign Offs",t.getCell("B15").alignment={horizontal:"center"},t.getCell("B15").font={bold:!0,color:{argb:"FFFFFFFF"}},t.mergeCells("B16:F19"),t.getCell("B16:F19").border={left:{style:"thin"},right:{style:"thin"}},t.getCell("C20").value=r.jpayrollEmployee||"",t.getCell("C20").alignment={horizontal:"center"},t.getCell("C20").border={top:{style:"thin"},bottom:{style:"thin"}},t.getCell("E20").value=r.clientName||"",t.getCell("E20").alignment={horizontal:"center"},t.getCell("E20").border={top:{style:"thin"},bottom:{style:"thin"}},t.getCell("B20").border={bottom:{style:"thin"},left:{style:"thin"}},t.getCell("D20").border={bottom:{style:"thin"}},t.getCell("F20").border={bottom:{style:"thin"},right:{style:"thin"}},t.eachRow({includeEmpty:!0},(c,g)=>{c.eachCell({includeEmpty:!0},(v,z)=>{z>1&&g<14&&(v.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}})})});const q=yield l.xlsx.writeBuffer(),_=new Blob([q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});N.saveAs(_,"ChangeOrderTemplate.xlsx")})()}parseRichText(r){const o=[],l={};let t=!1;const h=new T.iX({ontext(s){if(s.trim()){const C=t?"\u2022 ":"",u=s.split("\n");u.forEach((f,p)=>{f.trim()&&o.push({text:`${C}${f}`,font:{...l}}),p<u.length-1&&o.push({text:"\n"})})}},onclosetag(s){"li"===s&&t&&o.push({text:"\n"}),("b"===s||"strong"===s)&&(l.bold=!1),("i"===s||"em"===s)&&(l.italic=!1),"u"===s&&(l.underline=!1),("ul"===s||"ol"===s)&&(t=!1)},onopentag(s){("b"===s||"strong"===s)&&(l.bold=!0),("i"===s||"em"===s)&&(l.italic=!0),"u"===s&&(l.underline=!0),("ul"===s||"ol"===s)&&(t=!0)}});return h.write(r),h.end(),o}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var y=a(177);function x(n,m){if(1&n&&(e.j41(0,"div",20)(1,"label",46),e.EFF(2,"Change Details"),e.k0s(),e.j41(3,"div",10),e.nrm(4,"input",47),e.k0s()()),2&n){const r=e.XpG();e.R7$(4),e.Y8G("readonly",r.isReadonly)}}function B(n,m){if(1&n&&(e.j41(0,"div",48),e.nrm(1,"input",49),e.j41(2,"label",50),e.EFF(3),e.k0s()()),2&n){const r=m.$implicit,o=e.XpG();e.R7$(),e.Y8G("value",r.value)("readonly",o.isReadonly),e.R7$(2),e.JRh(r.label)}}function w(n,m){if(1&n&&(e.j41(0,"div",48),e.nrm(1,"input",51),e.j41(2,"label",50),e.EFF(3),e.k0s()()),2&n){const r=m.$implicit;e.R7$(),e.Y8G("value",r.value),e.R7$(2),e.JRh(r.label)}}function G(n,m){if(1&n&&(e.j41(0,"div",20)(1,"label",52),e.EFF(2,"JPayroll Employee"),e.k0s(),e.nrm(3,"input",53),e.k0s()),2&n){const r=e.XpG();e.R7$(3),e.Y8G("readonly",r.isReadonly)}}function U(n,m){if(1&n&&(e.j41(0,"div",20)(1,"label",52),e.EFF(2,"JPayroll Employee"),e.k0s(),e.nrm(3,"ngx-select-dropdown",54),e.k0s()),2&n){const r=e.XpG();e.R7$(3),e.Y8G("options",r.employees)("config",r.selectEmployeeConfig)("multiple",!1)}}function $(n,m){if(1&n){const r=e.RV6();e.j41(0,"div",42)(1,"button",55),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.makeInputsEditable())}),e.nrm(2,"span",56),e.k0s()()}}function S(n,m){if(1&n){const r=e.RV6();e.j41(0,"div",42)(1,"button",55),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.updateData())}),e.nrm(2,"span",57),e.k0s()()}}let A=(()=>{class n{constructor(r,o,l,t,h,s){this.route=r,this.fb=o,this.userService=l,this.excelService=t,this.location=h,this.router=s,this.employees=[],this.files=[],this.isReadonly=!0,this.Editor=i.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[i.uwK,i.C1k,i.Z4w,i.ayq,i.f4q,i.L$Z,i.tqO,i.yN4,i.J20,i.GkN,i.z2z,i.Y0,i.DZT,i.txU,i._V3,i.qIF,i.bsd,i.FUH,i.BRX,i.uXn,i.N_E,i.B8B,i.Syw,i.fzL,i.mYY,i.XIK,i.e1U],height:"400px"},this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search...",valueKey:"value"},this.priorities=[{label:"High",value:1},{label:"Moderate",value:2},{label:"Low",value:3}],this.statusprogresses=[{label:"On Pending",value:1},{label:"On Progress",value:2},{label:"Completed",value:3}],this.changeRequestForm=this.fb.group({clientId:[""],clientName:[""],customerAddress:[""],changeOrder:[""],refNo:[""],changeType:[""],changeDetails:[""],priority:[""],mandays:[""],deliveryDate:[""],comment:[""],jpayrollEmployee:[""],statusprogress:[""],Attachment:[""]})}ngOnInit(){this.fetchEmployees();const r=this.location.getState();r&&r.changeOrder&&(this.changeOrder=r.changeOrder,this.fetchChangeOrderData(this.changeOrder));const o=JSON.parse(localStorage.getItem("crud")||"{}");this.currentUserType=o;const l=JSON.parse(localStorage.getItem("currentUser")||"null");this.changeUser=l.UserId}makeInputsEditable(){this.isReadonly=!this.isReadonly}fetchEmployees(){this.userService.getEmployees().subscribe(r=>{this.employees=r.map(o=>({value:o.UserId,label:o.Name}))},r=>{console.error("Error fetching employees",r)})}fetchChangeOrderData(r){this.userService.getChangeOrderDetails(r).subscribe(o=>{if(o&&"success"===o.status&&o.data.length>0){const l=o.data[0];this.employeeID=l.UserId,this.fileid=l.FileId,this.changeRequestForm.patchValue({clientId:l.ClientId,clientName:l.ClientName,customerAddress:l.FullAddress,changeOrder:l.ChangeOrder,refNo:l.RefNumber,changeType:l.ChangeType,changeDetails:l.ChangeDetails,priority:l.Priority,mandays:l.Mandays,deliveryDate:l.DeliveryDate,comment:l.Comment,jpayrollEmployee:l.UserName,statusprogress:l.StatusProgress}),this.filePath=`backend/${l.FilePath}`}else console.error("No data found or error in response:",o)},o=>{console.error("Error fetching change order data:",o)})}updateData(){if(confirm("Are you sure you want to Update this change order?")){if(this.changeRequestForm.invalid)alert("Please fill all the required fields");else if(this.changeRequestForm.valid){const o={clientId:this.changeRequestForm.get("clientId")?.value,changeOrder:this.changeRequestForm.get("changeOrder")?.value,refNo:this.changeRequestForm.get("refNo")?.value,changeType:this.changeRequestForm.get("changeType")?.value,changeDetails:this.changeRequestForm.get("changeDetails")?.value,priority:this.changeRequestForm.get("priority")?.value,mandays:this.changeRequestForm.get("mandays")?.value,deliveryDate:this.changeRequestForm.get("deliveryDate")?.value,comment:this.changeRequestForm.get("comment")?.value,userId:this.changeRequestForm.get("jpayrollEmployee")?.value?.value||this.employeeID,statusProgress:this.changeRequestForm.get("statusprogress")?.value,fileId:this.fileid,UserChange:this.changeUser};if(this.files.length>0){const l=new FormData;l.append("file",this.files[0]),this.userService.uploadFiletodatabase(l).subscribe(t=>{o.fileId=t.fileId,this.callUpdateChangeOrder(o),this.isReadonly=!this.isReadonly},t=>{alert("File upload failed. Please try again."),console.error(t)})}else this.isReadonly=!this.isReadonly,this.callUpdateChangeOrder(o)}}else this.isReadonly=!this.isReadonly}callUpdateChangeOrder(r){this.userService.UpdateChangeOrder(r).subscribe(o=>{"success"===o.status?(alert("Request submitted successfully!"),this.router.navigate(["/ChangeOrder"],{})):"error"===o.status&&alert("Error: "+o.message)},o=>{alert("An unexpected error occurred. Please try again later."),console.error(o)})}OnDelete(){if(!confirm("Are you sure you want to delete this change order?"))return;const o={changeOrder:this.changeRequestForm.get("changeOrder")?.value,UserChange:this.changeUser};this.userService.DeleteChangeOrder(o).subscribe(l=>{"success"===l.status?(alert("Request submitted successfully!"),this.router.navigate(["/ChangeOrder"],{})):"error"===l.status&&alert("Error: "+l.message)},l=>{alert("An unexpected error occurred. Please try again later."),console.error(l)})}DownloadReport(){if(this.changeRequestForm.valid){const r=this.changeRequestForm.value;console.log(r),this.excelService.generateExcel(r)}else this.changeRequestForm.markAllAsTouched()}onFileChange(r){const o=r.target.files;if(this.files=[],o.length>0){const l=o[0];let t=l.name.replace(/\s+/g,"_");const h=new File([l],t,{type:l.type});this.files=[h],this.changeRequestForm.get("Attachment")?.setValue(!0)}}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(R.nX),e.rXU(d.ok),e.rXU(D.D),e.rXU(I),e.rXU(y.aZ),e.rXU(R.Ix))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-change-order-details"]],standalone:!0,features:[e.aNF],decls:83,vars:20,consts:[[1,"container","my-5"],[1,"d-flex","align-items-center","mb-4"],[1,"text-center","flex-grow-1","mb-0"],["type","button",1,"btn","btn-danger",3,"click"],[1,"e-icons","e-trash","e-large"],[3,"ngSubmit","formGroup"],[1,"border","p-4","mb-4"],[1,"w-auto","px-2"],[1,"mb-3","row"],["for","clientName",1,"col-sm-3","col-form-label"],[1,"col-sm-9"],["id","clientName","formControlName","clientName","readonly","true",1,"form-control"],["for","customerAddress",1,"col-sm-3","col-form-label"],["id","customerAddress","formControlName","customerAddress","readonly","true",1,"form-control"],[1,"row","mb-3"],[1,"col-sm-6"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder","readonly","",1,"form-control"],["for","refNo",1,"form-label"],["id","refNo","formControlName","refNo","readonly","",1,"form-control"],[1,"mb-3"],["for","changeType",1,"form-label"],["id","changeType","formControlName","changeType",1,"form-control",3,"readonly"],["class","mb-3",4,"ngIf"],["for","changeDetails",1,"form-label"],[1,"ckeditor-wrapper"],["formControlName","changeDetails",3,"editor","config"],[1,"form-label","me-3"],["class","form-check form-check-inline custom-radio",4,"ngFor","ngForOf"],[1,"form-check","custom-checkbox"],["type","checkbox","formControlName","Attachment",1,"form-check-input",3,"readonly"],["for","Attachment",1,"form-check-label"],["for","mandays",1,"form-label"],["id","mandays","formControlName","mandays","type","number",1,"form-control",3,"readonly"],["for","deliveryDate",1,"form-label"],["id","deliveryDate","type","date","formControlName","deliveryDate",1,"form-control",3,"min","readonly"],["for","comment",1,"form-label"],["formControlName","comment",3,"editor","config","disabled"],["download","",1,"hyperblue-link",3,"href"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],["class","col text-center",4,"ngIf"],[1,"col","text-center"],["type","button",1,"btn","btn-primary",3,"click"],[1,"e-icons","e-download","e-large"],["href",e.wXG`https://cdn.syncfusion.com/ej2/ej2-icons/styles/bootstrap5.css`,"rel","stylesheet"],["for","changeDetails",1,"col-sm-3","col-form-label"],["id","changeDetails","formControlName","changeDetails",1,"form-control",3,"readonly"],[1,"form-check","form-check-inline","custom-radio"],["type","radio","formControlName","priority",1,"form-check-input",3,"value","readonly"],[1,"form-check-label"],["type","radio","formControlName","statusprogress",1,"form-check-input",3,"value"],["for","jpayrollEmployee",1,"form-label"],["id","jpayrollEmployee","formControlName","jpayrollEmployee",1,"form-control",3,"readonly"],["formControlName","",3,"options","config","multiple"],["type","button",1,"btn","btn-warning",3,"click"],[1,"e-icons","e-edit","e-large"],[1,"e-icons","e-changes-track","e-large"]],template:function(o,l){if(1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"h1",2),e.EFF(3,"Change Order Details"),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return l.OnDelete()}),e.nrm(5,"span",4),e.k0s()(),e.j41(6,"form",5),e.bIt("ngSubmit",function(){return l.updateData()}),e.j41(7,"fieldset",6)(8,"legend",7),e.EFF(9,"Company Details"),e.k0s(),e.j41(10,"div",8)(11,"label",9),e.EFF(12,"Company Name"),e.k0s(),e.j41(13,"div",10),e.nrm(14,"input",11),e.k0s()(),e.j41(15,"div",8)(16,"label",12),e.EFF(17,"Customer Address"),e.k0s(),e.j41(18,"div",10),e.nrm(19,"input",13),e.k0s()()(),e.j41(20,"div",14)(21,"div",15)(22,"label",16),e.EFF(23,"Change Order"),e.k0s(),e.nrm(24,"input",17),e.k0s(),e.j41(25,"div",15)(26,"label",18),e.EFF(27,"Reference Number"),e.k0s(),e.nrm(28,"input",19),e.k0s()(),e.j41(29,"div",20)(30,"label",21),e.EFF(31,"Change Type"),e.k0s(),e.nrm(32,"input",22),e.k0s(),e.DNE(33,x,5,1,"div",23),e.j41(34,"div",20)(35,"label",24),e.EFF(36,"Change Details"),e.k0s(),e.j41(37,"div",25),e.nrm(38,"ckeditor",26),e.k0s()(),e.j41(39,"div",14)(40,"div",15)(41,"label",27),e.EFF(42,"Priority"),e.k0s(),e.DNE(43,B,4,3,"div",28),e.k0s(),e.j41(44,"div",15)(45,"div",29),e.nrm(46,"input",30),e.j41(47,"label",31),e.EFF(48,"Attachment"),e.k0s()()()(),e.j41(49,"div",14)(50,"div",15)(51,"label",32),e.EFF(52,"Mandays"),e.k0s(),e.nrm(53,"input",33),e.k0s(),e.j41(54,"div",15)(55,"label",34),e.EFF(56,"Delivery Date"),e.k0s(),e.nrm(57,"input",35),e.k0s()(),e.j41(58,"div",20)(59,"label",36),e.EFF(60,"Comment"),e.k0s(),e.j41(61,"div",25),e.nrm(62,"ckeditor",37),e.k0s()(),e.j41(63,"div",20)(64,"label",27),e.EFF(65,"Status Progress"),e.k0s(),e.DNE(66,w,4,2,"div",28),e.k0s(),e.DNE(67,G,4,1,"div",23)(68,U,4,3,"div",23),e.j41(69,"div",20)(70,"a",38),e.EFF(71,"Download Attachment"),e.k0s()(),e.j41(72,"div",20)(73,"label",39),e.EFF(74,"Upload Files"),e.k0s(),e.j41(75,"input",40),e.bIt("change",function(h){return l.onFileChange(h)}),e.k0s()(),e.j41(76,"div",14),e.DNE(77,$,3,0,"div",41)(78,S,3,0,"div",41),e.j41(79,"div",42)(80,"button",43),e.bIt("click",function(){return l.DownloadReport()}),e.nrm(81,"span",44),e.k0s()()()()(),e.nrm(82,"link",45)),2&o){let t;e.R7$(6),e.Y8G("formGroup",l.changeRequestForm),e.R7$(26),e.Y8G("readonly",l.isReadonly),e.R7$(),e.Y8G("ngIf","Other"===(null==(t=l.changeRequestForm.get("changeType"))?null:t.value)),e.R7$(5),e.Y8G("editor",l.Editor)("config",l.config),e.R7$(5),e.Y8G("ngForOf",l.priorities),e.R7$(3),e.Y8G("readonly",l.isReadonly),e.R7$(7),e.Y8G("readonly",l.isReadonly),e.R7$(4),e.Y8G("min",l.today)("min",l.minDeliveryDate)("readonly",l.isReadonly),e.R7$(5),e.Y8G("editor",l.Editor)("config",l.config)("disabled",!0),e.R7$(4),e.Y8G("ngForOf",l.statusprogresses),e.R7$(),e.Y8G("ngIf",1==l.isReadonly),e.R7$(),e.Y8G("ngIf",1!=l.isReadonly),e.R7$(2),e.Y8G("href",l.filePath,e.B4B),e.R7$(7),e.Y8G("ngIf",l.currentUserType&&l.isReadonly),e.R7$(),e.Y8G("ngIf",l.currentUserType&&!l.isReadonly)}},dependencies:[E.G,y.Sq,y.bT,d.qT,d.me,d.Q0,d.Zm,d.Fm,d.BC,d.cb,d.j4,d.JD,b.w8,b.hW,k.ae,k.W5],styles:[".hyperblue-link[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;font-weight:700;cursor:pointer}.hyperblue-link[_ngcontent-%COMP%]:hover{color:#00008b;text-decoration:none}.btn-red[_ngcontent-%COMP%]{background-color:red}"]})}}return n})()}}]);