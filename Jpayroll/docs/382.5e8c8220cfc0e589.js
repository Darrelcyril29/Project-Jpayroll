"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[382],{5382:(E,g,s)=>{s.r(g),s.d(g,{default:()=>b});var i=s(9417),u=s(7651),h=s(5490),n=s(4328),d=s(5974),e=s(4438),m=s(177),f=s(8064),p=s(1165);function _(c,y){1&c&&(e.j41(0,"div",23),e.EFF(1," Please provide title "),e.k0s())}function C(c,y){1&c&&(e.j41(0,"div",23),e.EFF(1," Please pick an Employee "),e.k0s())}let b=(()=>{class c{constructor(r,o,t,l){this.location=r,this.fb=o,this.userService=t,this.router=l,this.employees=[],this.files=[],this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search..."},this.Editor=n.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[n.uwK,n.C1k,n.Z4w,n.ayq,n.f4q,n.L$Z,n.tqO,n.yN4,n.J20,n.GkN,n.z2z,n.Y0,n.DZT,n.txU,n._V3,n.qIF,n.bsd,n.FUH,n.BRX,n.uXn,n.N_E,n.B8B,n.Syw,n.fzL,n.mYY,n.XIK,n.e1U],height:"400px"},this.ChangeLog=this.fb.group({changeOrder:["",i.k0.required],title:["",i.k0.required],comment:["",i.k0.required],jpayrollEmployee:["",i.k0.required],userId:["",i.k0.required],files:[null],Verified:[!1]})}ngOnInit(){this.fetchEmployees();const r=this.location.getState();this.changeLogId=r.ChangeLogId,this.companyname=r.CompanyName,this.getchangelogbyId(this.changeLogId)}getchangelogbyId(r){this.userService.getchangelogbyId(r).subscribe(o=>{if(o&&o.length>0){const t=o[0];this.fileId=t.FileId,this.changeorder=t.ChangeOrder,this.ChangeLog.patchValue({changeOrder:t.ChangeOrder,title:t.Title,comment:t.Comment,userId:t.UserId})}else console.error("No data found for the provided ChangeOrder!")},o=>{console.error("Error fetching ChangeLog data",o)})}onFileChange(r){const o=r.target.files;if(this.files=[],o.length>0){const t=o[0];let l=t.name.replace(/\s+/g,"_");const a=new File([t],l,{type:t.type});this.files=[a]}}onEmployeeChange(r){r?this.ChangeLog.patchValue({jpayrollEmployee:r.value,userId:r.value.value}):console.error("No employee selected!")}onEditorReady(r){console.log("Editor is ready:",r)}fetchEmployees(){this.userService.getEmployees().subscribe(r=>{this.employees=r.map(o=>({value:o.UserId,label:o.Name}))},r=>{console.error("Error fetching employees",r)})}onSubmit(){const r=this.ChangeLog.get("Verified")?.value?1:0;if(this.files.length>0){const o=new FormData;o.append("file",this.files[0]),this.userService.uploadFiletodatabase(o).subscribe(t=>{const l={changeOrder:this.ChangeLog.get("changeOrder")?.value,title:this.ChangeLog.get("title")?.value,comment:this.ChangeLog.get("comment")?.value,userId:this.ChangeLog.get("userId")?.value,fileId:t.fileId,changeLogId:this.changeLogId,verified:r};console.log(l),this.userService.UpdateChangeLog(l).subscribe(a=>{alert("Update has been submitted"),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},a=>{console.error("Error:",a)})},t=>{console.error("Error:",t)})}else{const o={changeOrder:this.ChangeLog.get("changeOrder")?.value,title:this.ChangeLog.get("title")?.value,comment:this.ChangeLog.get("comment")?.value,userId:this.ChangeLog.get("userId")?.value,fileId:this.fileId,changeLogId:this.changeLogId,verified:r};console.log(o),this.userService.UpdateChangeLog(o).subscribe(t=>{alert("Update has been submitted"),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},t=>{console.error("Error:",t)})}}OnDelete(){confirm("Are you sure you want to delete this change order?")&&this.userService.DeleteChangeLog({ChangeLog:this.changeLogId}).subscribe(t=>{"success"===t.status?alert("Request submitted successfully!"):"error"===t.status&&alert("Error: "+t.message),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},t=>{alert("An unexpected error occurred. Please try again later."),console.error(t)})}static{this.\u0275fac=function(o){return new(o||c)(e.rXU(m.aZ),e.rXU(i.ok),e.rXU(f.D),e.rXU(p.Ix))}}static{this.\u0275cmp=e.VBU({type:c,selectors:[["app-change-log-details"]],standalone:!0,features:[e.aNF],decls:39,vars:9,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder",1,"form-control",3,"readonly"],["for","title",1,"form-label"],["id","title","formControlName","title",1,"form-control"],["class","text-danger small",4,"ngIf"],["for","comment",1,"form-label"],[1,"ckeditor-wrapper"],["formControlName","comment",3,"editor","config"],["for","jpayrollEmployee",1,"form-label"],["formControlName","jpayrollEmployee",3,"change","options","config","multiple"],[1,"form-check","custom-checkbox"],["type","checkbox","formControlName","Verified",1,"form-check-input"],["for","Verified",1,"form-check-label"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],[1,"row","mb-3"],[1,"col"],["type","button",1,"btn","btn-success","w-100",3,"click"],["type","button",1,"btn","btn-primary","w-100",3,"click"],[1,"text-danger","small"]],template:function(o,t){if(1&o&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2,"Change Log Form"),e.k0s(),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return t.onSubmit()}),e.j41(4,"div",3)(5,"label",4),e.EFF(6,"Change Order"),e.k0s(),e.nrm(7,"input",5),e.k0s(),e.j41(8,"div",3)(9,"label",6),e.EFF(10,"Title"),e.k0s(),e.nrm(11,"input",7),e.DNE(12,_,2,0,"div",8),e.k0s(),e.j41(13,"div",3)(14,"label",9),e.EFF(15,"Comment"),e.k0s(),e.j41(16,"div",10),e.nrm(17,"ckeditor",11),e.k0s()(),e.j41(18,"div",3)(19,"label",12),e.EFF(20,"JPayroll Employee"),e.k0s(),e.j41(21,"ngx-select-dropdown",13),e.bIt("change",function(a){return t.onEmployeeChange(a)}),e.k0s(),e.DNE(22,C,2,0,"div",8),e.k0s(),e.j41(23,"div",3)(24,"div",14),e.nrm(25,"input",15),e.j41(26,"label",16),e.EFF(27,"Verified"),e.k0s()()(),e.j41(28,"div",3)(29,"label",17),e.EFF(30,"Upload Files"),e.k0s(),e.j41(31,"input",18),e.bIt("change",function(a){return t.onFileChange(a)}),e.k0s()(),e.j41(32,"div",19)(33,"div",20)(34,"button",21),e.bIt("click",function(){return t.onSubmit()}),e.EFF(35,"Update"),e.k0s()(),e.j41(36,"div",20)(37,"button",22),e.bIt("click",function(){return t.OnDelete()}),e.EFF(38,"Delete"),e.k0s()()()()()),2&o){let l,a;e.R7$(3),e.Y8G("formGroup",t.ChangeLog),e.R7$(4),e.Y8G("readonly",!0),e.R7$(5),e.Y8G("ngIf",(null==(l=t.ChangeLog.get("title"))?null:l.invalid)&&(null==(l=t.ChangeLog.get("title"))?null:l.touched)),e.R7$(5),e.Y8G("editor",t.Editor)("config",t.config),e.R7$(4),e.Y8G("options",t.employees)("config",t.selectEmployeeConfig)("multiple",!1),e.R7$(),e.Y8G("ngIf",(null==(a=t.ChangeLog.get("jpayrollEmployee"))?null:a.invalid)&&(null==(a=t.ChangeLog.get("jpayrollEmployee"))?null:a.touched))}},dependencies:[u.G,m.bT,i.qT,i.me,i.Zm,i.BC,i.cb,i.j4,i.JD,h.w8,h.hW,d.ae,d.W5],styles:[".ckeditor-wrapper[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:200px}.custom-radio[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{border:2px solid #333;border-radius:50%;width:18px;height:18px}.custom-radio[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:#007bff;border-color:#007bff}.custom-checkbox[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]{border:2px solid #333;width:18px;height:18px}.custom-checkbox[_ngcontent-%COMP%]   .form-check-input[_ngcontent-%COMP%]:checked{background-color:#007bff;border-color:#007bff}.form-control[readonly][_ngcontent-%COMP%]{background-color:#fff}"]})}}return c})()}}]);