"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[748],{9748:(B,_,c)=>{c.r(_),c.d(_,{default:()=>w});var a=c(4341),y=c(5490),r=c(4328),C=c(5974),R=c(2389),e=c(4438),E=c(6256),D=c(8064),b=c(177);function q(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please select a company "),e.k0s())}function I(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please provide change order "),e.k0s())}function N(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please provide reference number "),e.k0s())}function T(n,m){if(1&n&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&n){const o=m.$implicit;e.Y8G("value",o),e.R7$(),e.JRh(o)}}function j(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please Select a Change Type "),e.k0s())}function O(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1,' Please provide details for the "Other" change type. '),e.k0s())}function P(n,m){if(1&n&&(e.j41(0,"div",18)(1,"label",44),e.EFF(2,"Please Specify"),e.k0s(),e.nrm(3,"textarea",45),e.DNE(4,O,2,0,"div",9),e.k0s()),2&n){let o;const l=e.XpG();e.R7$(4),e.Y8G("ngIf",(null==(o=l.changeRequestForm.get("otherChangeDetails"))?null:o.invalid)&&(null==(o=l.changeRequestForm.get("otherChangeDetails"))?null:o.touched))}}function G(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please provide change details "),e.k0s())}function U(n,m){if(1&n&&(e.j41(0,"div",46),e.nrm(1,"input",47),e.j41(2,"label",48),e.EFF(3),e.k0s()()),2&n){const o=m.$implicit;e.R7$(),e.Y8G("value",o.value),e.R7$(2),e.JRh(o.label)}}function $(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please select a priority "),e.k0s())}function S(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Mandays must be at least 1. "),e.k0s())}function Y(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please provide Comment "),e.k0s())}function M(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please pick an Employee "),e.k0s())}function A(n,m){1&n&&(e.j41(0,"div",42),e.EFF(1," Please Upload a file "),e.k0s())}let w=(()=>{class n{constructor(o,l,t,i){this.fb=o,this.route=l,this.userService=t,this.router=i,this.clients=[],this.employees=[],this.files=[],this.Editor=r.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[r.uwK,r.C1k,r.Z4w,r.ayq,r.f4q,r.L$Z,r.tqO,r.yN4,r.J20,r.GkN,r.z2z,r.Y0,r.DZT,r.txU,r._V3,r.qIF,r.bsd,r.FUH,r.BRX,r.uXn,r.N_E,r.B8B,r.Syw,r.fzL,r.mYY,r.XIK,r.e1U],height:"400px"},this.selectConfig={displayKey:"ClientName",search:!0,placeholder:"Select Company",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search...",height:"200px"},this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search...",height:"200px"},this.priorities=[{label:"High",value:1},{label:"Moderate",value:2},{label:"Low",value:3}],this.changeTypeOptions=["Formula Assessment","Custom Program","Other"];const s=new Date;s.setDate(s.getDate()+1),this.minDeliveryDate=s.toISOString().split("T")[0],this.today=(new Date).toISOString().split("T")[0],this.changeRequestForm=this.fb.group({clientId:["",a.k0.required],clientName:["",a.k0.required],customeraddress:[{value:"",disabled:!0}],files:[null],changeOrder:["",a.k0.required],refNo:["",a.k0.required],changeType:["",a.k0.required],changeDetails:["",a.k0.required],priority:["",a.k0.required],mandays:["",[a.k0.required,a.k0.min(1)]],Attachment:[{value:!1,disabled:!0}],deliveryDate:[this.minDeliveryDate,[a.k0.required]],comment:["",a.k0.required],jpayrollEmployee:["",a.k0.required],userId:["",a.k0.required],otherChangeDetails:[""]})}ngOnInit(){this.fetchClients(),this.fetchEmployees();const l=JSON.parse(localStorage.getItem("currentUser")||"{}");this.currentUserType=l.UserId}fetchClients(){this.userService.getClients().subscribe(o=>{this.clients=o},o=>{console.error("Error fetching clients",o)})}fetchEmployees(){this.userService.getEmployees().subscribe(o=>{this.employees=o.map(l=>({value:l.UserId,label:l.Name}))},o=>{console.error("Error fetching employees",o)})}onCompanyChange(o){const l=o.value;if(l){const t=l.ClientId;this.changeRequestForm.patchValue({customeraddress:l.FullAddress});const i=this.clients.find(s=>s.ClientId===t);i&&(this.changeRequestForm.get("customeraddress")?.enable(),this.changeRequestForm.patchValue({clientId:t,customeraddress:i.FullAddress}))}else console.error("No client selected!")}onEmployeeChange(o){o?this.changeRequestForm.patchValue({jpayrollEmployee:o.value,userId:o.value.value}):console.error("No employee selected!")}onSubmit(){if(0!=this.changeRequestForm.get("Attachment")?.value)if(this.changeRequestForm.valid){const o=new FormData;o.append("file",this.files[0]),this.userService.uploadFiletodatabase(o).subscribe(l=>{const t={clientId:this.changeRequestForm.get("clientId")?.value,changeOrder:this.changeRequestForm.get("changeOrder")?.value,refNo:this.changeRequestForm.get("refNo")?.value,changeType:this.changeRequestForm.get("changeType")?.value,changeDetails:this.changeRequestForm.get("changeDetails")?.value,priority:this.changeRequestForm.get("priority")?.value,mandays:this.changeRequestForm.get("mandays")?.value,deliveryDate:this.changeRequestForm.get("deliveryDate")?.value,comment:this.changeRequestForm.get("comment")?.value,userId:this.changeRequestForm.get("userId")?.value,otherChangeDetails:this.changeRequestForm.get("otherChangeDetails")?.value||null,UserChange:this.currentUserType,fileId:l.fileId};this.userService.insertChangeRequest(t).subscribe(i=>{"success"===i.status?(alert("Form Has been submitted"),this.router.navigate(["/ChangeOrder"],{}),document.getElementById("files").value=""):"error"===i.status&&alert(i.message)},i=>{console.error("Error:",i)})},l=>{console.error("Error:",l)})}else this.changeRequestForm.markAllAsTouched();else alert("Please Upload File")}onFileChange(o){const l=o.target.files;if(this.files=[],l.length>0){const t=l[0];let i=t.name.replace(/\s+/g,"_");const s=new File([t],i,{type:t.type});this.files=[s],this.changeRequestForm.get("Attachment")?.setValue(!0)}}static{this.\u0275fac=function(l){return new(l||n)(e.rXU(a.ok),e.rXU(E.nX),e.rXU(D.D),e.rXU(E.Ix))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-change-form"]],standalone:!0,features:[e.aNF],decls:81,vars:27,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"border","p-4","mb-4"],[1,"w-auto","px-2"],[1,"mb-3","row"],["for","clientName",1,"col-sm-3","col-form-label"],[1,"col-sm-9"],["formControlName","clientName",3,"change","options","config","multiple"],["class","text-danger small",4,"ngIf"],["for","customeraddress",1,"col-sm-3","col-form-label"],["id","customeraddress","formControlName","customeraddress",1,"form-control"],[1,"row","mb-3"],[1,"col-sm-6"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder",1,"form-control"],["for","refNo",1,"form-label"],["id","refNo","formControlName","refNo",1,"form-control"],[1,"mb-3"],["for","changeType",1,"form-label"],["id","changeType","formControlName","changeType",1,"form-select"],[3,"value",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],["for","changeDetails",1,"form-label"],[1,"ckeditor-wrapper"],["formControlName","changeDetails",3,"editor","config"],[1,"form-label","me-3"],["class","form-check form-check-inline custom-radio",4,"ngFor","ngForOf"],[1,"form-check","custom-checkbox"],["type","checkbox","formControlName","Attachment",1,"form-check-input"],["for","Attachment",1,"form-check-label"],["for","mandays",1,"form-label"],["id","mandays","formControlName","mandays","type","number",1,"form-control"],["for","deliveryDate",1,"form-label"],["id","deliveryDate","type","date","formControlName","deliveryDate",1,"form-control",3,"min"],["for","comment",1,"form-label"],["formControlName","comment",3,"editor","config"],["for","jpayrollEmployee",1,"form-label"],["formControlName","jpayrollEmployee",3,"change","options","config","multiple"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],["type","submit",1,"btn","btn-primary","w-100"],[1,"text-danger","small"],[3,"value"],["for","otherChangeDetails",1,"form-label"],["id","otherChangeDetails","formControlName","otherChangeDetails","rows","3",1,"form-control"],[1,"form-check","form-check-inline","custom-radio"],["type","radio","formControlName","priority",1,"form-check-input",3,"value"],[1,"form-check-label"]],template:function(l,t){if(1&l&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2,"Change Request Form"),e.k0s(),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return t.onSubmit()}),e.j41(4,"fieldset",3)(5,"legend",4),e.EFF(6,"Company Details"),e.k0s(),e.j41(7,"div",5)(8,"label",6),e.EFF(9,"Company Name"),e.k0s(),e.j41(10,"div",7)(11,"ngx-select-dropdown",8),e.bIt("change",function(s){return t.onCompanyChange(s)}),e.k0s(),e.DNE(12,q,2,0,"div",9),e.k0s()(),e.j41(13,"div",5)(14,"label",10),e.EFF(15,"Customer Address"),e.k0s(),e.j41(16,"div",7),e.nrm(17,"input",11),e.k0s()()(),e.j41(18,"div",12)(19,"div",13)(20,"label",14),e.EFF(21,"Change Order"),e.k0s(),e.nrm(22,"input",15),e.DNE(23,I,2,0,"div",9),e.k0s(),e.j41(24,"div",13)(25,"label",16),e.EFF(26,"Reference Number"),e.k0s(),e.nrm(27,"input",17),e.DNE(28,N,2,0,"div",9),e.k0s()(),e.j41(29,"div",18)(30,"label",19),e.EFF(31,"Change Type"),e.k0s(),e.j41(32,"select",20),e.DNE(33,T,2,2,"option",21),e.k0s(),e.DNE(34,j,2,0,"div",9),e.k0s(),e.DNE(35,P,5,1,"div",22),e.j41(36,"div",18)(37,"label",23),e.EFF(38,"Change Details"),e.k0s(),e.j41(39,"div",24),e.nrm(40,"ckeditor",25),e.k0s(),e.DNE(41,G,2,0,"div",9),e.k0s(),e.j41(42,"div",12)(43,"div",13)(44,"label",26),e.EFF(45,"Priority"),e.k0s(),e.DNE(46,U,4,2,"div",27)(47,$,2,0,"div",9),e.k0s(),e.j41(48,"div",13)(49,"div",28),e.nrm(50,"input",29),e.j41(51,"label",30),e.EFF(52,"Attachment"),e.k0s()()()(),e.j41(53,"div",12)(54,"div",13)(55,"label",31),e.EFF(56,"Mandays"),e.k0s(),e.nrm(57,"input",32),e.DNE(58,S,2,0,"div",9),e.k0s(),e.j41(59,"div",13)(60,"label",33),e.EFF(61,"Delivery Date"),e.k0s(),e.nrm(62,"input",34),e.k0s()(),e.j41(63,"div",18)(64,"label",35),e.EFF(65,"Comment"),e.k0s(),e.j41(66,"div",24),e.nrm(67,"ckeditor",36),e.k0s(),e.DNE(68,Y,2,0,"div",9),e.k0s(),e.j41(69,"div",18)(70,"label",37),e.EFF(71,"JPayroll Employee"),e.k0s(),e.j41(72,"ngx-select-dropdown",38),e.bIt("change",function(s){return t.onEmployeeChange(s)}),e.k0s(),e.DNE(73,M,2,0,"div",9),e.k0s(),e.j41(74,"div",18)(75,"label",39),e.EFF(76,"Upload Files"),e.k0s(),e.j41(77,"input",40),e.bIt("change",function(s){return t.onFileChange(s)}),e.k0s()(),e.DNE(78,A,2,0,"div",9),e.j41(79,"button",41),e.EFF(80,"Submit"),e.k0s()()()),2&l){let i,s,u,d,k,h,g,f,p,F,v;e.R7$(3),e.Y8G("formGroup",t.changeRequestForm),e.R7$(8),e.Y8G("options",t.clients)("config",t.selectConfig)("multiple",!1),e.R7$(),e.Y8G("ngIf",(null==(i=t.changeRequestForm.get("clientId"))?null:i.invalid)&&(null==(i=t.changeRequestForm.get("clientId"))?null:i.touched)),e.R7$(5),e.BMQ("readonly",!0),e.R7$(6),e.Y8G("ngIf",(null==(s=t.changeRequestForm.get("changeOrder"))?null:s.invalid)&&(null==(s=t.changeRequestForm.get("changeOrder"))?null:s.touched)),e.R7$(5),e.Y8G("ngIf",(null==(u=t.changeRequestForm.get("refNo"))?null:u.invalid)&&(null==(u=t.changeRequestForm.get("refNo"))?null:u.touched)),e.R7$(5),e.Y8G("ngForOf",t.changeTypeOptions),e.R7$(),e.Y8G("ngIf",(null==(d=t.changeRequestForm.get("changeType"))?null:d.invalid)&&(null==(d=t.changeRequestForm.get("changeType"))?null:d.touched)),e.R7$(),e.Y8G("ngIf","Other"===(null==(k=t.changeRequestForm.get("changeType"))?null:k.value)),e.R7$(5),e.Y8G("editor",t.Editor)("config",t.config),e.R7$(),e.Y8G("ngIf",(null==(h=t.changeRequestForm.get("changeDetails"))?null:h.invalid)&&(null==(h=t.changeRequestForm.get("changeDetails"))?null:h.touched)),e.R7$(5),e.Y8G("ngForOf",t.priorities),e.R7$(),e.Y8G("ngIf",(null==(g=t.changeRequestForm.get("priority"))?null:g.invalid)&&(null==(g=t.changeRequestForm.get("priority"))?null:g.touched)),e.R7$(11),e.Y8G("ngIf",(null==(f=t.changeRequestForm.get("mandays"))?null:f.invalid)&&(null==(f=t.changeRequestForm.get("mandays"))?null:f.touched)),e.R7$(4),e.Y8G("min",t.today)("min",t.minDeliveryDate),e.R7$(5),e.Y8G("editor",t.Editor)("config",t.config),e.R7$(),e.Y8G("ngIf",(null==(p=t.changeRequestForm.get("comment"))?null:p.invalid)&&(null==(p=t.changeRequestForm.get("comment"))?null:p.touched)),e.R7$(4),e.Y8G("options",t.employees)("config",t.selectEmployeeConfig)("multiple",!1),e.R7$(),e.Y8G("ngIf",(null==(F=t.changeRequestForm.get("jpayrollEmployee"))?null:F.invalid)&&(null==(F=t.changeRequestForm.get("jpayrollEmployee"))?null:F.touched)),e.R7$(5),e.Y8G("ngIf",(null==(v=t.changeRequestForm.get("files"))?null:v.invalid)&&(null==(v=t.changeRequestForm.get("files"))?null:v.touched))}},dependencies:[y.w8,y.hW,C.ae,C.W5,a.YN,a.qT,a.xH,a.y7,a.me,a.Q0,a.Zm,a.wz,a.Fm,a.BC,a.cb,R.G,b.Sq,b.bT,a.j4,a.JD],styles:[".custom-radio .form-check-input{border:2px solid #333;border-radius:50%;width:18px;height:18px}.custom-radio .form-check-input:checked{background-color:#007bff;border-color:#007bff}.custom-checkbox .form-check-input{border:2px solid #333;width:18px;height:18px}.custom-checkbox .form-check-input:checked{background-color:#007bff;border-color:#007bff}.form-control[readonly]{background-color:#fff}.ckeditor-wrapper .ck-editor__editable{min-height:200px}\n"],encapsulation:2})}}return n})()}}]);