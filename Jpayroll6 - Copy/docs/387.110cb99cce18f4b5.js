"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[387],{8387:(L,F,s)=>{s.r(F),s.d(F,{default:()=>Y});var E=s(2389),b=s(5490),i=s(4328),k=s(5974),e=s(4438),R=s(6256),d=s(4341),D=s(8064),O=s(467),j=s(2887),N=s(2578),T=s(7482);let I=(()=>{class n{constructor(){}generateExcel(r){var o=this;return(0,O.A)(function*(){const l=new j.Workbook,t=l.addWorksheet("Sheet 1");t.columns=[{key:"A",width:2},{key:"B",width:20},{key:"C",width:20},{key:"D",width:10},{key:"E",width:20},{key:"F",width:25}];try{const g=yield(yield fetch("../../../assets/images/JpayrollLogo.png")).arrayBuffer(),v=l.addImage({buffer:g,extension:"png"});t.addImage(v,{tl:{col:1,row:0},ext:{width:150,height:40}})}catch(c){console.error("Error loading image:",c)}t.mergeCells("B1:D2"),t.mergeCells("E1:F1"),t.getCell("E1").value="Change Order",t.getCell("E1").font={bold:!0,size:14},t.getCell("E1").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("E2:F2"),t.getCell("E2").value=r.changeOrder,t.getCell("E2").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("B3:F3"),t.getCell("B3").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B3").value="Project Information",t.getCell("B3").alignment={horizontal:"center"},t.getCell("B3").font={bold:!0,color:{argb:"FFFFFFFF"}},t.getCell("B4").value="Customer Name",t.getCell("C4").value=r.clientName||"",t.mergeCells("C4:D4"),t.getCell("B5").value="Customer Address",t.getCell("C5").value=r.customerAddress||"",t.mergeCells("C5:F5"),t.getCell("E4").value="Ref No",t.getCell("E4").alignment={vertical:"middle",horizontal:"right"},t.mergeCells("F4:F4"),t.getCell("F4").value=r.refNo||"",t.mergeCells("B7:F7"),t.getCell("B7").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B7").value="Change Order Information",t.getCell("B7").alignment={horizontal:"center"},t.getCell("B7").font={bold:!0,color:{argb:"FFFFFFFF"}},t.getCell("B8").value="Change Type",t.getCell("B9").value="Change Details",t.getCell("B10").value="Priority",t.getCell("B11").value="Mandays",t.getCell("B12").value="Delivery Date",t.getCell("B13").value="Comments",t.getCell("C8").value=r.changeType,t.getCell("C9").value={richText:o.parseRichText(r.changeDetails)};const a=o.parseRichText(r.changeDetails),C=a.map(c=>c.text).join("").split("\n").length,u=a.reduce((c,g)=>c+g.text.length,0)/40,f=Math.ceil(C+u);t.getRow(9).height=Math.max(20,15*f),t.getCell("C9").alignment={wrapText:!0},r.priority=(r.priority=1)?"High":(r.priority=2)?"Medium":"Low",t.getCell("C10").value=r.priority||"",t.getCell("C11").value=r.mandays||"",t.getCell("C12").value=r.deliveryDate||"",t.getCell("C13").value={richText:o.parseRichText(r.comment)};const p=o.parseRichText(r.comment),P=p.map(c=>c.text).join("").split("\n").length,_=p.reduce((c,g)=>c+g.text.length,0)/40,X=Math.ceil(P+_);t.getRow(13).height=Math.max(20,15*X),t.getCell("C13").alignment={wrapText:!0},t.mergeCells("C8:F8"),t.mergeCells("C9:F9"),t.mergeCells("C10:F10"),t.mergeCells("C11:F11"),t.mergeCells("C12:F12"),t.mergeCells("C13:F13"),t.mergeCells("B15:F15"),t.getCell("B15").fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF000000"}},t.getCell("B15").value="Sign Offs",t.getCell("B15").alignment={horizontal:"center"},t.getCell("B15").font={bold:!0,color:{argb:"FFFFFFFF"}},t.mergeCells("B16:F19"),t.getCell("B16:F19").border={left:{style:"thin"},right:{style:"thin"}},t.getCell("C20").value=r.jpayrollEmployee||"",t.getCell("C20").alignment={horizontal:"center"},t.getCell("C20").border={top:{style:"thin"},bottom:{style:"thin"}},t.getCell("E20").value=r.clientName||"",t.getCell("E20").alignment={horizontal:"center"},t.getCell("E20").border={top:{style:"thin"},bottom:{style:"thin"}},t.getCell("B20").border={bottom:{style:"thin"},left:{style:"thin"}},t.getCell("D20").border={bottom:{style:"thin"}},t.getCell("F20").border={bottom:{style:"thin"},right:{style:"thin"}},t.eachRow({includeEmpty:!0},(c,g)=>{c.eachCell({includeEmpty:!0},(v,M)=>{M>1&&g<14&&(v.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}})})});const q=yield l.xlsx.writeBuffer(),z=new Blob([q],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});N.saveAs(z,"ChangeOrderTemplate.xlsx")})()}parseRichText(r){const o=[],l={};let t=!1;const h=new T.iX({ontext(a){if(a.trim()){const C=t?"\u2022 ":"",u=a.split("\n");u.forEach((f,p)=>{f.trim()&&o.push({text:`${C}${f}`,font:{...l}}),p<u.length-1&&o.push({text:"\n"})})}},onclosetag(a){"li"===a&&t&&o.push({text:"\n"}),("b"===a||"strong"===a)&&(l.bold=!1),("i"===a||"em"===a)&&(l.italic=!1),"u"===a&&(l.underline=!1),("ul"===a||"ol"===a)&&(t=!1)},onopentag(a){("b"===a||"strong"===a)&&(l.bold=!0),("i"===a||"em"===a)&&(l.italic=!0),"u"===a&&(l.underline=!0),("ul"===a||"ol"===a)&&(t=!0)}});return h.write(r),h.end(),o}static{this.\u0275fac=function(o){return new(o||n)}}static{this.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var y=s(177);function x(n,m){if(1&n&&(e.j41(0,"div",17)(1,"label",41),e.EFF(2,"Change Details"),e.k0s(),e.j41(3,"div",7),e.nrm(4,"input",42),e.k0s()()),2&n){const r=e.XpG();e.R7$(4),e.Y8G("readonly",r.isReadonly)}}function B(n,m){if(1&n&&(e.j41(0,"div",43),e.nrm(1,"input",44),e.j41(2,"label",45),e.EFF(3),e.k0s()()),2&n){const r=m.$implicit,o=e.XpG();e.R7$(),e.Y8G("value",r.value)("readonly",o.isReadonly),e.R7$(2),e.JRh(r.label)}}function w(n,m){if(1&n&&(e.j41(0,"div",43),e.nrm(1,"input",46),e.j41(2,"label",45),e.EFF(3),e.k0s()()),2&n){const r=m.$implicit;e.R7$(),e.Y8G("value",r.value),e.R7$(2),e.JRh(r.label)}}function G(n,m){if(1&n&&(e.j41(0,"div",17)(1,"label",47),e.EFF(2,"JPayroll Employee"),e.k0s(),e.nrm(3,"input",48),e.k0s()),2&n){const r=e.XpG();e.R7$(3),e.Y8G("readonly",r.isReadonly)}}function U(n,m){if(1&n&&(e.j41(0,"div",17)(1,"label",47),e.EFF(2,"JPayroll Employee"),e.k0s(),e.nrm(3,"ngx-select-dropdown",49),e.k0s()),2&n){const r=e.XpG();e.R7$(3),e.Y8G("options",r.employees)("config",r.selectEmployeeConfig)("multiple",!1)}}function $(n,m){if(1&n){const r=e.RV6();e.j41(0,"div",39)(1,"button",50),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.makeInputsEditable())}),e.EFF(2,"Edit"),e.k0s()()}}function S(n,m){if(1&n){const r=e.RV6();e.j41(0,"div",39)(1,"button",51),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.OnDelete())}),e.EFF(2,"Delete"),e.k0s()()}}function A(n,m){if(1&n){const r=e.RV6();e.j41(0,"div",39)(1,"button",52),e.bIt("click",function(){e.eBV(r);const l=e.XpG();return e.Njj(l.updateData())}),e.EFF(2,"Update"),e.k0s()()}}let Y=(()=>{class n{constructor(r,o,l,t,h,a){this.route=r,this.fb=o,this.userService=l,this.excelService=t,this.location=h,this.router=a,this.employees=[],this.files=[],this.isReadonly=!0,this.Editor=i.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[i.uwK,i.C1k,i.Z4w,i.ayq,i.f4q,i.L$Z,i.tqO,i.yN4,i.J20,i.GkN,i.z2z,i.Y0,i.DZT,i.txU,i._V3,i.qIF,i.bsd,i.FUH,i.BRX,i.uXn,i.N_E,i.B8B,i.Syw,i.fzL,i.mYY,i.XIK,i.e1U],height:"400px"},this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search...",valueKey:"value"},this.priorities=[{label:"High",value:1},{label:"Moderate",value:2},{label:"Low",value:3}],this.statusprogresses=[{label:"On Pending",value:1},{label:"On Progress",value:2},{label:"Completed",value:3}],this.changeRequestForm=this.fb.group({clientId:[""],clientName:[""],customerAddress:[""],changeOrder:[""],refNo:[""],changeType:[""],changeDetails:[""],priority:[""],mandays:[""],deliveryDate:[""],comment:[""],jpayrollEmployee:[""],statusprogress:[""],Attachment:[""]})}ngOnInit(){this.fetchEmployees();const r=this.location.getState();r&&r.changeOrder&&(this.changeOrder=r.changeOrder,this.fetchChangeOrderData(this.changeOrder));const o=JSON.parse(localStorage.getItem("crud")||"{}");this.currentUserType=o;const l=JSON.parse(localStorage.getItem("currentUser")||"null");this.changeUser=l.UserId}makeInputsEditable(){this.isReadonly=!this.isReadonly}fetchEmployees(){this.userService.getEmployees().subscribe(r=>{this.employees=r.map(o=>({value:o.UserId,label:o.Name}))},r=>{console.error("Error fetching employees",r)})}fetchChangeOrderData(r){this.userService.getChangeOrderDetails(r).subscribe(o=>{if(o&&"success"===o.status&&o.data.length>0){const l=o.data[0];this.employeeID=l.UserId,this.fileid=l.FileId,this.changeRequestForm.patchValue({clientId:l.ClientId,clientName:l.ClientName,customerAddress:l.FullAddress,changeOrder:l.ChangeOrder,refNo:l.RefNumber,changeType:l.ChangeType,changeDetails:l.ChangeDetails,priority:l.Priority,mandays:l.Mandays,deliveryDate:l.DeliveryDate,comment:l.Comment,jpayrollEmployee:l.UserName,statusprogress:l.StatusProgress}),this.filePath=`backend/${l.FilePath}`}else console.error("No data found or error in response:",o)},o=>{console.error("Error fetching change order data:",o)})}updateData(){if(this.changeRequestForm.invalid)alert("Please fill all the required fields");else if(this.changeRequestForm.valid){const r={clientId:this.changeRequestForm.get("clientId")?.value,changeOrder:this.changeRequestForm.get("changeOrder")?.value,refNo:this.changeRequestForm.get("refNo")?.value,changeType:this.changeRequestForm.get("changeType")?.value,changeDetails:this.changeRequestForm.get("changeDetails")?.value,priority:this.changeRequestForm.get("priority")?.value,mandays:this.changeRequestForm.get("mandays")?.value,deliveryDate:this.changeRequestForm.get("deliveryDate")?.value,comment:this.changeRequestForm.get("comment")?.value,userId:this.changeRequestForm.get("jpayrollEmployee")?.value?.value||this.employeeID,statusProgress:this.changeRequestForm.get("statusprogress")?.value,fileId:this.fileid,UserChange:this.changeUser};if(this.files.length>0){const o=new FormData;o.append("file",this.files[0]),this.userService.uploadFiletodatabase(o).subscribe(l=>{r.fileId=l.fileId,this.callUpdateChangeOrder(r)},l=>{alert("File upload failed. Please try again."),console.error(l)})}else this.callUpdateChangeOrder(r)}}callUpdateChangeOrder(r){this.userService.UpdateChangeOrder(r).subscribe(o=>{"success"===o.status?(alert("Request submitted successfully!"),this.router.navigate(["/ChangeOrder"],{})):"error"===o.status&&alert("Error: "+o.message)},o=>{alert("An unexpected error occurred. Please try again later."),console.error(o)})}OnDelete(){if(!confirm("Are you sure you want to delete this change order?"))return;const o={changeOrder:this.changeRequestForm.get("changeOrder")?.value,UserChange:this.changeUser};this.userService.DeleteChangeOrder(o).subscribe(l=>{"success"===l.status?(alert("Request submitted successfully!"),this.router.navigate(["/ChangeOrder"],{})):"error"===l.status&&alert("Error: "+l.message)},l=>{alert("An unexpected error occurred. Please try again later."),console.error(l)})}DownloadReport(){if(this.changeRequestForm.valid){const r=this.changeRequestForm.value;console.log(r),this.excelService.generateExcel(r)}else this.changeRequestForm.markAllAsTouched()}onFileChange(r){const o=r.target.files;if(this.files=[],o.length>0){const l=o[0];let t=l.name.replace(/\s+/g,"_");const h=new File([l],t,{type:l.type});this.files=[h],this.changeRequestForm.get("Attachment")?.setValue(!0)}}static{this.\u0275fac=function(o){return new(o||n)(e.rXU(R.nX),e.rXU(d.ok),e.rXU(D.D),e.rXU(I),e.rXU(y.aZ),e.rXU(R.Ix))}}static{this.\u0275cmp=e.VBU({type:n,selectors:[["app-change-order-details"]],standalone:!0,features:[e.aNF],decls:81,vars:21,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"border","p-4","mb-4"],[1,"w-auto","px-2"],[1,"mb-3","row"],["for","clientName",1,"col-sm-3","col-form-label"],[1,"col-sm-9"],["id","clientName","formControlName","clientName","readonly","true",1,"form-control"],["for","customerAddress",1,"col-sm-3","col-form-label"],["id","customerAddress","formControlName","customerAddress","readonly","true",1,"form-control"],[1,"row","mb-3"],[1,"col-sm-6"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder","readonly","",1,"form-control"],["for","refNo",1,"form-label"],["id","refNo","formControlName","refNo","readonly","",1,"form-control"],[1,"mb-3"],["for","changeType",1,"form-label"],["id","changeType","formControlName","changeType",1,"form-control",3,"readonly"],["class","mb-3",4,"ngIf"],["for","changeDetails",1,"form-label"],[1,"ckeditor-wrapper"],["formControlName","changeDetails",3,"editor","config"],[1,"form-label","me-3"],["class","form-check form-check-inline custom-radio",4,"ngFor","ngForOf"],[1,"form-check","custom-checkbox"],["type","checkbox","formControlName","Attachment",1,"form-check-input",3,"readonly"],["for","Attachment",1,"form-check-label"],["for","mandays",1,"form-label"],["id","mandays","formControlName","mandays","type","number",1,"form-control",3,"readonly"],["for","deliveryDate",1,"form-label"],["id","deliveryDate","type","date","formControlName","deliveryDate",1,"form-control",3,"min","readonly"],["for","comment",1,"form-label"],["formControlName","comment",3,"editor","config","disabled"],["download","",1,"hyperblue-link",3,"href"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],["class","col",4,"ngIf"],[1,"col"],["type","button",1,"btn","btn-primary","w-100",3,"click"],["for","changeDetails",1,"col-sm-3","col-form-label"],["id","changeDetails","formControlName","changeDetails",1,"form-control",3,"readonly"],[1,"form-check","form-check-inline","custom-radio"],["type","radio","formControlName","priority",1,"form-check-input",3,"value","readonly"],[1,"form-check-label"],["type","radio","formControlName","statusprogress",1,"form-check-input",3,"value"],["for","jpayrollEmployee",1,"form-label"],["id","jpayrollEmployee","formControlName","jpayrollEmployee",1,"form-control",3,"readonly"],["formControlName","",3,"options","config","multiple"],["type","button",1,"btn","btn-warning","w-100",3,"click"],["type","button",1,"btn","btn-red","w-100",3,"click"],["type","button",1,"btn","btn-success","w-100",3,"click"]],template:function(o,l){if(1&o&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2,"Change Order Details"),e.k0s(),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return l.updateData()}),e.j41(4,"fieldset",3)(5,"legend",4),e.EFF(6,"Company Details"),e.k0s(),e.j41(7,"div",5)(8,"label",6),e.EFF(9,"Company Name"),e.k0s(),e.j41(10,"div",7),e.nrm(11,"input",8),e.k0s()(),e.j41(12,"div",5)(13,"label",9),e.EFF(14,"Customer Address"),e.k0s(),e.j41(15,"div",7),e.nrm(16,"input",10),e.k0s()()(),e.j41(17,"div",11)(18,"div",12)(19,"label",13),e.EFF(20,"Change Order"),e.k0s(),e.nrm(21,"input",14),e.k0s(),e.j41(22,"div",12)(23,"label",15),e.EFF(24,"Reference Number"),e.k0s(),e.nrm(25,"input",16),e.k0s()(),e.j41(26,"div",17)(27,"label",18),e.EFF(28,"Change Type"),e.k0s(),e.nrm(29,"input",19),e.k0s(),e.DNE(30,x,5,1,"div",20),e.j41(31,"div",17)(32,"label",21),e.EFF(33,"Change Details"),e.k0s(),e.j41(34,"div",22),e.nrm(35,"ckeditor",23),e.k0s()(),e.j41(36,"div",11)(37,"div",12)(38,"label",24),e.EFF(39,"Priority"),e.k0s(),e.DNE(40,B,4,3,"div",25),e.k0s(),e.j41(41,"div",12)(42,"div",26),e.nrm(43,"input",27),e.j41(44,"label",28),e.EFF(45,"Attachment"),e.k0s()()()(),e.j41(46,"div",11)(47,"div",12)(48,"label",29),e.EFF(49,"Mandays"),e.k0s(),e.nrm(50,"input",30),e.k0s(),e.j41(51,"div",12)(52,"label",31),e.EFF(53,"Delivery Date"),e.k0s(),e.nrm(54,"input",32),e.k0s()(),e.j41(55,"div",17)(56,"label",33),e.EFF(57,"Comment"),e.k0s(),e.j41(58,"div",22),e.nrm(59,"ckeditor",34),e.k0s()(),e.j41(60,"div",17)(61,"label",24),e.EFF(62,"Status Progress"),e.k0s(),e.DNE(63,w,4,2,"div",25),e.k0s(),e.DNE(64,G,4,1,"div",20)(65,U,4,3,"div",20),e.j41(66,"div",17)(67,"a",35),e.EFF(68,"Download Attachment"),e.k0s()(),e.j41(69,"div",17)(70,"label",36),e.EFF(71,"Upload Files"),e.k0s(),e.j41(72,"input",37),e.bIt("change",function(h){return l.onFileChange(h)}),e.k0s()(),e.j41(73,"div",11),e.DNE(74,$,3,0,"div",38)(75,S,3,0,"div",38),e.k0s(),e.j41(76,"div",11),e.DNE(77,A,3,0,"div",38),e.j41(78,"div",39)(79,"button",40),e.bIt("click",function(){return l.DownloadReport()}),e.EFF(80,"Download Report"),e.k0s()()()()()),2&o){let t;e.R7$(3),e.Y8G("formGroup",l.changeRequestForm),e.R7$(26),e.Y8G("readonly",l.isReadonly),e.R7$(),e.Y8G("ngIf","Other"===(null==(t=l.changeRequestForm.get("changeType"))?null:t.value)),e.R7$(5),e.Y8G("editor",l.Editor)("config",l.config),e.R7$(5),e.Y8G("ngForOf",l.priorities),e.R7$(3),e.Y8G("readonly",l.isReadonly),e.R7$(7),e.Y8G("readonly",l.isReadonly),e.R7$(4),e.Y8G("min",l.today)("min",l.minDeliveryDate)("readonly",l.isReadonly),e.R7$(5),e.Y8G("editor",l.Editor)("config",l.config)("disabled",!0),e.R7$(4),e.Y8G("ngForOf",l.statusprogresses),e.R7$(),e.Y8G("ngIf",1==l.isReadonly),e.R7$(),e.Y8G("ngIf",1!=l.isReadonly),e.R7$(2),e.Y8G("href",l.filePath,e.B4B),e.R7$(7),e.Y8G("ngIf",1==l.currentUserType),e.R7$(),e.Y8G("ngIf",1==l.currentUserType),e.R7$(2),e.Y8G("ngIf",1==l.currentUserType)}},dependencies:[E.G,y.Sq,y.bT,d.qT,d.me,d.Q0,d.Zm,d.Fm,d.BC,d.cb,d.j4,d.JD,b.w8,b.hW,k.ae,k.W5],styles:[".hyperblue-link[_ngcontent-%COMP%]{color:#00f;text-decoration:underline;font-weight:700;cursor:pointer}.hyperblue-link[_ngcontent-%COMP%]:hover{color:#00008b;text-decoration:none}.btn-red[_ngcontent-%COMP%]{background-color:red}"]})}}return n})()}}]);