"use strict";(self.webpackChunkmantis_free_version=self.webpackChunkmantis_free_version||[]).push([[382],{5382:(b,h,i)=>{i.r(h),i.d(h,{default:()=>y});var a=i(4341),u=i(2389),c=i(5490),n=i(4328),d=i(5974),e=i(4438),m=i(177),p=i(8064),f=i(6256);function _(g,E){1&g&&(e.j41(0,"div",20),e.EFF(1," Please provide title "),e.k0s())}function C(g,E){1&g&&(e.j41(0,"div",20),e.EFF(1," Please pick an Employee "),e.k0s())}let y=(()=>{class g{constructor(r,o,t,l){this.location=r,this.fb=o,this.userService=t,this.router=l,this.employees=[],this.files=[],this.selectEmployeeConfig={displayKey:"label",search:!0,placeholder:"Select Employee",moreText:"More...",noResultsFound:"No results found!",searchPlaceholder:"Search..."},this.Editor=n.aRV,this.config={toolbar:["heading","|","bold","italic","strikethrough","underline","|","alignment","|","fontSize","fontFamily","highlight","|","bulletedList","numberedList","|","link","|","undo","redo"],plugins:[n.uwK,n.C1k,n.Z4w,n.ayq,n.f4q,n.L$Z,n.tqO,n.yN4,n.J20,n.GkN,n.z2z,n.Y0,n.DZT,n.txU,n._V3,n.qIF,n.bsd,n.FUH,n.BRX,n.uXn,n.N_E,n.B8B,n.Syw,n.fzL,n.mYY,n.XIK,n.e1U],height:"400px"},this.ChangeLog=this.fb.group({changeOrder:["",a.k0.required],title:["",a.k0.required],comment:["",a.k0.required],jpayrollEmployee:["",a.k0.required],userId:["",a.k0.required],files:[null]})}ngOnInit(){this.fetchEmployees();const r=this.location.getState();this.changeLogId=r.ChangeLogId,this.companyname=r.CompanyName,this.getchangelogbyId(this.changeLogId)}getchangelogbyId(r){this.userService.getchangelogbyId(r).subscribe(o=>{if(o&&o.length>0){const t=o[0];this.fileId=t.FileId,this.changeorder=t.ChangeOrder,this.ChangeLog.patchValue({changeOrder:t.ChangeOrder,title:t.Title,comment:t.Comment,userId:t.UserId})}else console.error("No data found for the provided ChangeOrder!")},o=>{console.error("Error fetching ChangeLog data",o)})}onFileChange(r){const o=r.target.files;if(this.files=[],o.length>0){const t=o[0];let l=t.name.replace(/\s+/g,"_");const s=new File([t],l,{type:t.type});this.files=[s]}}onEmployeeChange(r){r?this.ChangeLog.patchValue({jpayrollEmployee:r.value,userId:r.value.value}):console.error("No employee selected!")}onEditorReady(r){console.log("Editor is ready:",r)}fetchEmployees(){this.userService.getEmployees().subscribe(r=>{this.employees=r.map(o=>({value:o.UserId,label:o.Name}))},r=>{console.error("Error fetching employees",r)})}onSubmit(){if(this.files.length>0){const r=new FormData;r.append("file",this.files[0]),this.userService.uploadFiletodatabase(r).subscribe(o=>{const t={changeOrder:this.ChangeLog.get("changeOrder")?.value,title:this.ChangeLog.get("title")?.value,comment:this.ChangeLog.get("comment")?.value,userId:this.ChangeLog.get("userId")?.value,fileId:o.fileId,changeLogId:this.changeLogId};this.userService.UpdateChangeLog(t).subscribe(l=>{alert("Update has been submitted"),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},l=>{console.error("Error:",l)})},o=>{console.error("Error:",o)})}else{const r={changeOrder:this.ChangeLog.get("changeOrder")?.value,title:this.ChangeLog.get("title")?.value,comment:this.ChangeLog.get("comment")?.value,userId:this.ChangeLog.get("userId")?.value,fileId:this.fileId,changeLogId:this.changeLogId};this.userService.UpdateChangeLog(r).subscribe(o=>{alert("Update has been submitted"),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},o=>{console.error("Error:",o)})}}OnDelete(){confirm("Are you sure you want to delete this change order?")&&this.userService.DeleteChangeLog({ChangeLog:this.changeLogId}).subscribe(t=>{"success"===t.status?alert("Request submitted successfully!"):"error"===t.status&&alert("Error: "+t.message),this.router.navigateByUrl("/ChangeLog",{state:{changeOrder:this.changeorder,company:this.companyname}})},t=>{alert("An unexpected error occurred. Please try again later."),console.error(t)})}static{this.\u0275fac=function(o){return new(o||g)(e.rXU(m.aZ),e.rXU(a.ok),e.rXU(p.D),e.rXU(f.Ix))}}static{this.\u0275cmp=e.VBU({type:g,selectors:[["app-change-log-details"]],standalone:!0,features:[e.aNF],decls:34,vars:9,consts:[[1,"container","my-5"],[1,"text-center","mb-4"],[3,"ngSubmit","formGroup"],[1,"mb-3"],["for","changeOrder",1,"form-label"],["id","changeOrder","formControlName","changeOrder",1,"form-control",3,"readonly"],["for","title",1,"form-label"],["id","title","formControlName","title",1,"form-control"],["class","text-danger small",4,"ngIf"],["for","comment",1,"form-label"],[1,"ckeditor-wrapper"],["formControlName","comment",3,"editor","config"],["for","jpayrollEmployee",1,"form-label"],["formControlName","jpayrollEmployee",3,"change","options","config","multiple"],["for","files",1,"form-label"],["id","files","type","file",1,"form-control",3,"change"],[1,"row","mb-3"],[1,"col"],["type","button",1,"btn","btn-success","w-100",3,"click"],["type","button",1,"btn","btn-primary","w-100",3,"click"],[1,"text-danger","small"]],template:function(o,t){if(1&o&&(e.j41(0,"div",0)(1,"h1",1),e.EFF(2,"Change Log Form"),e.k0s(),e.j41(3,"form",2),e.bIt("ngSubmit",function(){return t.onSubmit()}),e.j41(4,"div",3)(5,"label",4),e.EFF(6,"Change Order"),e.k0s(),e.nrm(7,"input",5),e.k0s(),e.j41(8,"div",3)(9,"label",6),e.EFF(10,"Title"),e.k0s(),e.nrm(11,"input",7),e.DNE(12,_,2,0,"div",8),e.k0s(),e.j41(13,"div",3)(14,"label",9),e.EFF(15,"Comment"),e.k0s(),e.j41(16,"div",10),e.nrm(17,"ckeditor",11),e.k0s()(),e.j41(18,"div",3)(19,"label",12),e.EFF(20,"JPayroll Employee"),e.k0s(),e.j41(21,"ngx-select-dropdown",13),e.bIt("change",function(s){return t.onEmployeeChange(s)}),e.k0s(),e.DNE(22,C,2,0,"div",8),e.k0s(),e.j41(23,"div",3)(24,"label",14),e.EFF(25,"Upload Files"),e.k0s(),e.j41(26,"input",15),e.bIt("change",function(s){return t.onFileChange(s)}),e.k0s()(),e.j41(27,"div",16)(28,"div",17)(29,"button",18),e.bIt("click",function(){return t.onSubmit()}),e.EFF(30,"Update"),e.k0s()(),e.j41(31,"div",17)(32,"button",19),e.bIt("click",function(){return t.OnDelete()}),e.EFF(33,"Delete"),e.k0s()()()()()),2&o){let l,s;e.R7$(3),e.Y8G("formGroup",t.ChangeLog),e.R7$(4),e.Y8G("readonly",!0),e.R7$(5),e.Y8G("ngIf",(null==(l=t.ChangeLog.get("title"))?null:l.invalid)&&(null==(l=t.ChangeLog.get("title"))?null:l.touched)),e.R7$(5),e.Y8G("editor",t.Editor)("config",t.config),e.R7$(4),e.Y8G("options",t.employees)("config",t.selectEmployeeConfig)("multiple",!1),e.R7$(),e.Y8G("ngIf",(null==(s=t.ChangeLog.get("jpayrollEmployee"))?null:s.invalid)&&(null==(s=t.ChangeLog.get("jpayrollEmployee"))?null:s.touched))}},dependencies:[u.G,m.bT,a.qT,a.me,a.BC,a.cb,a.j4,a.JD,c.w8,c.hW,d.ae,d.W5],styles:[".ckeditor-wrapper[_ngcontent-%COMP%]   .ck-editor__editable[_ngcontent-%COMP%]{min-height:200px}"]})}}return g})()}}]);